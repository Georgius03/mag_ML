# Тема

Методы искусственного интеллекта. EDA. Линейная регрессия. Дерево решений. CatBoost. XGBoost. Нейронные сети (MLP).

# Цель работы

Целю данной работы заключается в получении навыков анализа первичных данных и определение признаков взаимосвязи (EDA), понимания моделей: линейная регрессия, дерево решений, CatBoost, XGBoost, нейронные сети (MLP) и умения разрабатывать программу на языке Python для реализации представленных моделей.

# Задание
## Основные пункты к исполнению

1) Описать датасета и определить влияние признаков и выбрать признаки, которые наиболее подходят для поставленной задачи предсказания (EDA).
2) Построить пайплйан (DVC) исходя из результатов EDA.
3) Реализовать линейную регрессию, определить весовые коэффициенты, метрики и ошибки.
4) Реализовать дерево решений, определить метрики и ошибки. Привести рисунок первых узлов дерева решений.
5) Реализовать CatBoost, определить метрики и ошибки. Выгрузить Feature Importance.
6) Реализовать XGBoost, определить метрики и ошибки. Выгрузить Feature Importance.
7) Реализовать нейронную сеть, определить метрики, ошибки, кривые обучения, гистограммы весов с интерпретацией и график из Tensorboard.
8) Выгрузить конечный вычислительный граф DVC.
9) Построить сводную таблицу с метриками и сделать вывод какая модель отработала лучше и почему.
10) Сделать вывод по работе.

## Анализ данных
После проведенного анализа данных должно быть понятно:
1) Какие признаки будут использованы для предсказания и почему?
2) Как будут преобразованы выбранные признаки и почему?
3) Оценить значимость каждого признака?
В конце EDA должен быть полный и исчерпывающий вывод о том, какие данные и как будет решаться поставленная задача.

# Описание датасета

## Контекст

Этот набор данных содержит информацию о величине медицинских расходов страховых контрагентов

## insurance.csv

- возраст: возраст основного выгодоприобретателя
- пол: пол страхового контрагента, женщина, мужчина
- bmi: индекс массы тела, обеспечивающий понимание тела, веса, который является относительно высоким или низким по отношению к росту, объективный показатель массы тела (кг / м ^ 2), использующий отношение роста к весу, в идеале от 18,5 до 24,9
- дети: количество детей, охваченных медицинским страхованием / Количество иждивенцев
- курильщик: курение
- регион: район проживания бенефициара в США, северо-восток, юго-восток, юго-запад, северо-запад.
- расходы: индивидуальные медицинские расходы, выставленные медицинским страхованием

# Ход работы

## Формирование структуры проекта

Проект организован стандартным образом в соостветствии с использованием [DVC (Data Version Control)](https://dvc.org/), что облегчает навигацию:

- [config/](config/): Директория для конфигурационных файлов проекта.
- [data/](data/): Содержит исходные данные. Поддиректория raw/ хранит сам файл insurance.csv, версионируемый через DVC.
- [dvc_plots/](dvc_plots/): Визуализации и графики, сгенерированные в процессе экспериментов DVC.
- [notebooks/](notebooks/): Jupyter ноутбуки с разведочным анализом данных (EDA).
- [src/](src/): Исходный код на Python, разбитый на модули ([для загрузки данных и подготовки признаков](src/data), [обучения каждой из моделей](src/models)) для осуществления пайплайна.
- [dvc.yaml](dvc.yaml) и [dvc.lock](dvc.lock): Файлы, определяющие пайплайн (этапы обработки и обучения) и фиксирующие его текущее состояние.
- [README.md](README.md): Текущий файл с описанием проекта (который Вы читаете).

## Результаты проведения [EDA](notebooks/EDA.ipynb)

Изначально после загрузки данных через `pandas` и вызова методов `describe` и `info` было выявлено, что
- В данных отсутствуют пустые строки.
- От выбросов данные чистить нельзя, ввиду того, что это реальные значения, а не показания сенсоров (которые часто имеют высокую степень зашумлённости).
- Необходимо привести текстовые столбцы к OneHot формат.
- Необходимо логарифмирование целевой переменной "charge", ввиду её высокой дисперсии.
- Столбец "кол-во детей" возможно привести к OneHot формату исходя из отношений (=0, [1, 2], >3).
- Остальные численные колонки выборки необходимо нормализовать.

При помощи функций из `sklearn.preprocessing`: `OneHotEncoder`, `LabelBinarizer`, `StandardScaler`, а также самописной функции `children_category` была произведена обработка данных.


- `sex(пол)`, `smoker(курильщик)` ввиду наличия только двух состояний были закодированы при помощи `LabelBinarizer`.
- `children(дети)`, был приведён к формату **(=0, [1, 2], >3) $\rightarrow$ (0, 1, 2)** при помощи `children_category` и вместе со столбцом `region` были приведены к **OneHot** формату при помощи `OneHotEncoder`
- `age`, `bmi`, для лучшей сходимости градиентов стандартизованы при помощи `StandardScaler`

При помощи метода `ProfileReport` из `ydata_profiling` был получен интерактивный отчёт в формате **HTML**, который включает в себя:

- Обзор структуры датасета: типы данных, количество пропусков, размерность.
- Детальную статистику по каждому признаку: распределение значений, квантили, гистограммы, выявление выбросов.
- Диаграммы взаимосвязей признаков, таких как - Матрица корреляции (для числовых признаков).

В процессе генерации отчёта автоматически строятся диаграммы, которые помогают визуально оценить структуру данных. Одной из наиболее информативных является тепловая карта корреляции. На ней отражены значения коэффициента корреляции Пирсона, показывающие силу и направление линейной связи между числовыми переменными.

Ниже представлен пример такой тепловой карты, полученной для подготовленного исследуемого датасета `insurance.csv`:

![corr_matrix_image](images/corr_matrix.png)

А также пример статистики по одному из признаков **(bmi)**

![bmi_hist_image](images/bmi_hist.png)

![bmi_add_image](images/bmi_add.png)

На представленном графике [corr_matrix_image](corr_matrix_image) мы можем наблюдать следующие ключевые моменты:

Целевая переменная (expenses): Видна её слабая положительная корреляция с возрастом (age) и индексом массы тела (bmi). Это говорит о том, что с увеличением возраста и BMI медицинские расходы имеют тенденцию к росту, что является интуитивно понятным и важным сигналом для будущих моделей.

Признаки (age, bmi, children): Корреляция между самими признаками (например, age и bmi, age и children) практически отсутствует (значения близки к 0). Это хорошо для моделей, чувствительных к мультиколлинеарности (например, для линейной регрессии), так как признаки не дублируют друг друга.




## Инициализация git и dvc

```bash
dvc exp run
```